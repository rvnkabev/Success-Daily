<!-- …(head, styles, main page remain unchanged)… -->

<!-- 2-Sub-categories -->
<div class="page" id="pageSub">
  <h2 id="subCategoryTitle"></h2>
  <div id="subButtons"></div>
</div>

<!-- …(other pages remain unchanged)… -->

<script>
/* ---------- Categories ---------- */
const categoryMap={
  Health:["Swim","Gym","Other"],
  MentalHealth:["DelayGratification","SelfControl","Other"],
  Relationship:["HappyWifeHappyLife","Friendship","Other"],
  Listen:["NoInterrupt","Understand","Empathy","Other"],
  Finance:[],
  Work:["A12","MEWP","Communication","Other"],
  Pomodoro:["English","Finance","Reading","Review"],
  Reflect:[],
  Other:[]
};

let selectedCategory='';
let selectedSubCategory='';

/* ---------- Helpers ---------- */
const fmtTime=()=>{
  const d=new Date();
  let h=d.getHours(),m=d.getMinutes().toString().padStart(2,'0');
  const am=h>=12?'pm':'am';
  h=h%12||12;
  return `${h}:${m}${am}`;
};
const fmtDate=()=>{
  const now=new Date();
  return new Date(now.getTime()-now.getTimezoneOffset()*60000)
         .toISOString().split('T')[0];
};
const hidePages=()=>document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));

/* ---------- Navigation ---------- */
function selectCategory(cat){
  if(cat==='Reflect'){startReflection();return;}
  selectedCategory=cat;selectedSubCategory='';
  const subs=categoryMap[cat]||[];
  if(subs.length>0&&cat!=='Pomodoro'){
    buildSubButtons(subs);hidePages();document.getElementById('pageSub').classList.add('active');
  }else if(cat==='Pomodoro'){
    buildSubButtons(subs);hidePages();document.getElementById('pageSub').classList.add('active');
  }else{gotoInput();}
}

function buildSubButtons(arr){
  const wrap=document.getElementById('subButtons');wrap.innerHTML='';
  document.getElementById('subCategoryTitle').textContent=selectedCategory;   /* ← brackets removed */
  arr.forEach(s=>{
    const b=document.createElement('button');b.textContent=s;
    b.onclick=()=>selectSubCategory(s);wrap.appendChild(b);
  });
}

function selectSubCategory(sub){
  selectedSubCategory=sub;
  if(selectedCategory==='Pomodoro'){logPomodoro();}
  else{gotoInput();}
}

/* ---------- Input page ---------- */
function gotoInput(){
  hidePages();
  document.getElementById('selectedCategoryLabel').textContent=`[${selectedCategory}]`;
  document.getElementById('currentTime').textContent=fmtTime();
  document.getElementById('content').value='';
  document.getElementById('pageInput').classList.add('active');
}

/* ---------- Reflect flow ---------- */
function startReflection(){hidePages();document.getElementById('reflect1').classList.add('active');}
function nextPage(i){document.getElementById('reflect'+i).classList.remove('active');
  document.getElementById('reflect'+(i+1)).classList.add('active');}

/* ---------- Save ---------- */
function buildEntry(text){
  const date=fmtDate(),time=fmtTime();
  const tags=`#${selectedCategory}`+(selectedSubCategory?` #${selectedSubCategory}`:'');
  return `${date}\n${time} ｜ ${selectedCategory}｜ ${text} ${tags}`;
}
function send(encoded,isFin){
  if(isFin){
    const u1=`shortcuts://run-shortcut?name=SaveToSuccessDaily&input=text&text=${encoded}`;
    const u2=`shortcuts://run-shortcut?name=SaveToInvestment&input=text&text=${encoded}`;
    window.open(u1);setTimeout(()=>window.location.href=u2,500);
  }else{
    window.location.href=`shortcuts://run-shortcut?name=SaveToSuccessDaily&input=text&text=${encoded}`;
  }
}
function saveToNotes(){
  const txt=document.getElementById('content').value.trim();
  if(!txt){alert("Please enter something!");return;}
  send(encodeURIComponent(buildEntry(txt)),selectedCategory==='Finance');
}
function logPomodoro(){
  send(encodeURIComponent(buildEntry('25mins')),false);
  hidePages();document.getElementById('page1').classList.add('active');
}

/* ---------- Reflect save ---------- */
function submitReflection(){
  const ans=[1,2,3,4,5].map(i=>document.getElementById('answer'+i).value.trim());
  const note=`
Success Diary:
1. Future actions: ${ans[0]}
2. Emotion handling: ${ans[1]}
3. Self-support: ${ans[2]}
4. Active listening: ${ans[3]}
5. Love for wife: ${ans[4]}
  `.trim();
  window.location.href=
    `shortcuts://run-shortcut?name=SaveToSuccessDaily&input=text&text=${encodeURIComponent(note)}`;
}
</script>
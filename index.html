<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>成功日記</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1em;
      background-color: #f9f9f9;
      font-size: 300%;
      text-align: center;
    }
    .hidden { display: none; }
    .page { display: none; }
    .active { display: block; }
    button {
      margin: 0.5em;
      padding: 0.3em 1em;
      font-size: 100%;
    }
    input, textarea {
      width: 90%;
      padding: 0.5em;
      font-size: 100%;
      margin: 1em 0;
    }
  </style>
</head>
<body>

<!-- 頁面一：選擇類別 -->
<div id="page1" class="active">
  <h1>選擇類別</h1>
  <button onclick="selectCategory('聆聽')">聆聽</button>
  <button onclick="selectCategory('健康')">健康</button>
  <button onclick="selectCategory('心靈')">心靈</button>
  <button onclick="selectCategory('人際')">人際</button>
  <button onclick="selectCategory('Fin')">Fin</button>
  <button onclick="startReflection()">反省</button>
  <button onclick="selectCategory('其他')">其他</button>
</div>

<!-- 頁面二：輸入內容 -->
<div id="page2" class="hidden">
  <h1 id="selectedCategoryLabel">類別</h1>
  <p id="currentTime"></p>
  <input type="text" id="content" placeholder="輸入內容..." />
  <button onclick="saveToNotes()">儲存到 iPhone Notes</button>
</div>

<!-- 四頁反省問題 -->
<div class="page" id="reflect1">
  <h2>1. 我有冇為未來做一樣事？（運動、學習、人際、金融）</h2>
  <textarea id="answer1"></textarea>
  <button onclick="nextPage(1)">下一頁</button>
</div>

<div class="page" id="reflect2">
  <h2>2. 我有冇出現情緒困擾？我點處理？</h2>
  <textarea id="answer2"></textarea>
  <button onclick="nextPage(2)">下一頁</button>
</div>

<div class="page" id="reflect3">
  <h2>3. 我有冇說一句支持自己嘅說話？做咗一樣值得讚自己嘅事？</h2>
  <textarea id="answer3"></textarea>
  <button onclick="nextPage(3)">下一頁</button>
</div>

<div class="page" id="reflect4">
  <h2>4. 我有冇認真聽別人講嘢，而唔係想證明自己？</h2>
  <textarea id="answer4"></textarea>
  <button onclick="submitReflection()">儲存到 iPhone Notes</button>
</div>

<script>
  let selectedCategory = '';

  function getCurrentTimeFormatted() {
    const now = new Date();
    let hours = now.getHours();
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const ampm = hours >= 12 ? 'pm' : 'am';
    hours = hours % 12;
    hours = hours ? hours : 12;
    return `${hours}:${minutes}${ampm}`;
  }

  function getTodayDateStr() {
    const today = new Date();
    return today.toISOString().split('T')[0];
  }

  function selectCategory(category) {
    selectedCategory = category;
    document.getElementById('selectedCategoryLabel').textContent = category;
    document.getElementById('currentTime').textContent = getCurrentTimeFormatted();

    document.getElementById('page1').classList.add('hidden');
    document.getElementById('page2').classList.remove('hidden');
  }

  function startReflection() {
    document.getElementById('page1').classList.add('hidden');
    document.getElementById('reflect1').classList.add('active');
  }

  function nextPage(current) {
    document.getElementById('reflect' + current).classList.remove('active');
    document.getElementById('reflect' + (current + 1)).classList.add('active');
  }

  function saveToNotes() {
    const content = document.getElementById('content').value;
    if (!content) {
      alert("請輸入內容！");
      return;
    }

    const time = getCurrentTimeFormatted();
    const date = getTodayDateStr();
    const entry = `${date}\n${time} ｜ ${selectedCategory} ｜ ${content}`;
    const encoded = encodeURIComponent(entry);

    if (selectedCategory === 'Fin') {
      const url1 = `shortcuts://run-shortcut?name=SaveToSuccessDaily&input=text&text=${encoded}`;
      const url2 = `shortcuts://run-shortcut?name=SaveToInvestment&input=text&text=${encoded}`;
      window.open(url1);
      setTimeout(() => {
        window.location.href = url2;
      }, 500);
    } else {
      const url = `shortcuts://run-shortcut?name=SaveToSuccessDaily&input=text&text=${encoded}`;
      window.location.href = url;
    }
  }

  function submitReflection() {
    const answers = [
      document.getElementById('answer1').value.trim(),
      document.getElementById('answer2').value.trim(),
      document.getElementById('answer3').value.trim(),
      document.getElementById('answer4').value.trim()
    ];

    const noteContent = `
成功日記：
1. 為未來：${answers[0]}
2. 情緒處理：${answers[1]}
3. 自我支持與自讚：${answers[2]}
4. 認真聆聽：${answers[3]}
    `.trim();

    const encoded = encodeURIComponent(noteContent);
    const shortcutURL = `shortcuts://run-shortcut?name=SaveToSuccessDaily&input=text&text=${encoded}`;
    window.location.href = shortcutURL;
  }
</script>

</body>
</html>